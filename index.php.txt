<?php
// ph-master-02:/var/www/midas/rms/ari/live_apx/admin/version_03_new/web [ ph-master-02 ]# cat backfill_generator/backfill_gen_helper_v1.php 
// Version 1.3 : Removing body wrapper, ad proper size to ad-preview
// Version 1.2 : Adding option for keyword selector. + Original-pub-backfill is used with new sp sp_ph_select_pubkey_adtecurl_site_from_placement_key_bf1_2_v1
// Version 1.1 : Adding Option to check html in browser . 2016-04-21
// Version 1.0 : Helper script to Generte Backfill V1.2 Pixel With Registerd In-Pabe Pub-Backfil code. Created on 2016-04-21


//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
/**
 * [BF12_getInpageData_rmsAri Return inpage data or zero
 * @param [string] $placementKey Inpage placement key
 */

function BF12_getInpageData_rmsAri( $placementKey ){
  	
  	require_once('../../includes/config/config.inc.php');
	require_once('../../includes/libs/MysqliDatabase.class.php');

    $db = MysqliDatabase::getInstance(constant('DB_CON_STRING_IP'));

	// $sql = "CALL sp_ph_select_pubkey_adtecurl_site_from_placement_key_v22('$placementKey')";
	$sql = "CALL sp_ph_select_pubkey_adtecurl_site_from_placement_key_bf1_2_v2('$placementKey')";

	$row = $db->multi_query($sql, /*$isSingleResultSet*/false, __FUNCTION__);

	#echo '<pre>'; var_dump( $row ); die();
    if( !empty($row) && !empty($row[0]) && !empty($row[0][0]) ){
		$ret=array();
		$row = $row[0][0];
		$ret['placement_id'] = $row['placement_id']; // Adtech Placement Id
		$ret['rms_placement_id'] = $row['rms_placement_id'];
		$ret['rms_placement_name'] = $row['rms_placement_name'];
		$ret['size_id'] = $row['size_id'];
		//$ret['original_backfill_code'] = trim($row['original_backfill_code']);
		$ret['original_backfill_code'] = trim($row['original_backfill_code']);
		return $ret;
    }

    return 0;
}

//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
/**
 * [BF1_2_getPixelTag Return V5/LG pixel as javascript tag to log Backfill Campaign or Error message as array('erMsg'=>val, 'jsCode'=>val)
 * @param string $placementKey     Inpage Placement key
 * @param string $placement_id     Adtech placement id
 * @param string $rms_placement_id [description]
 * @param string $backfillKeyword  Optional,
 *
 * @return  array('erMsg'=>val, 'jsCode'=>val)
 */
function BF1_2_getPixelTag( $placementKey , $placement_id , $rms_placement_id , $backfillKeyword='google_backfill'){
	$placementKey = trim( $placementKey );
	$placement_id = trim( $placement_id );
	$rms_placement_id = trim( $rms_placement_id );
	$backfillKeyword= trim( $backfillKeyword);


	$ret['erMsg']="";
	$ret['jsCode']="";
	if( empty( $placementKey ) ){ $ret['erMsg']="Invalid placementKey"; }
	#if( empty( $placement_id ) ){ $ret['erMsg']="Invalid placement_id"; }
	if( empty( $rms_placement_id ) ){ $ret['erMsg']="Invalid rms_placement_id"; }
	if( empty( $backfillKeyword ) ){ $backfillKeyword="google_backfill"; }

// 	if( empty( $ret['erMsg'] ) ){
// 		$ret['jsCode'] = <<<BF_2_JS_TAG
// <script type="text/javascript">document.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=in&u=hard-coded-uid-v1.2-'+(new Date()).getTime()+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra=692283321101&nwa=13&nta=3&ncm=151&p=v1.2&ch=chx&tm='+(new Date()).getTime()+'" width="0" height="0" style="display:none !important">');</script>
// BF_2_JS_TAG;
// 	}

	// cc value change to none
	if( empty( $ret['erMsg'] ) ){
		$ret['jsCode'] = <<<BF_2_JS_TAG
<script type="text/javascript">document.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=none&u=hard-coded-uid-v1.2-'+(new Date()).getTime()+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra=692283321101&nwa=13&nta=3&ncm=151&p=v1.2&ch=chx&tm='+(new Date()).getTime()+'" width="0" height="0" style="display:none !important">');</script>
BF_2_JS_TAG;
	}

	return $ret;
}
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
/**
 * [BF1_2_getPixelTag Return Inuxu V5/LG pixel as javascript tag to log Backfill Campaign or Error message as array('erMsg'=>val, 'jsCode'=>val)
 * @param string $placementKey     Inpage Placement key
 * @param string $placement_id     Adtech placement id
 * @param string $rms_placement_id [description]
 * @param string $backfillKeyword  Optional,
 *
 * @return  array('erMsg'=>val, 'jsCode'=>val)
 */
function BF1_2_getInuxuPixelTag( $placementKey , $placement_id , $rms_placement_id , $backfillKeyword='inuxu_backfill'){
	$placementKey = trim( $placementKey );
	$placement_id = trim( $placement_id );
	$rms_placement_id = trim( $rms_placement_id );
	$backfillKeyword= trim( $backfillKeyword);

	$ret['erMsg']="";
	$ret['jsCode']="";
	if( empty( $placementKey ) ){ $ret['erMsg']="Invalid placementKey"; }
	#if( empty( $placement_id ) ){ $ret['erMsg']="Invalid placement_id"; }
	if( empty( $rms_placement_id ) ){ $ret['erMsg']="Invalid rms_placement_id"; }
	if( empty( $backfillKeyword ) ){ $backfillKeyword="google_backfill"; }

    $inuxuRmsAdvId='189542200000';
    $inuxuPhAdvId='104';
    $inuxuPhCampaign='156';
    // nta=3 is Next adv type: Always PH (3 )
// 	if( empty( $ret['erMsg'] ) ){
// 		$ret['jsCode'] = <<<BF_2_JS_TAG
// <script type="text/javascript">
// var d=document,_eu=function(a){return encodeURIComponent(a)},dt=(new Date()).getTime();d.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=in&u=hard-coded-uid-v1.2-'+dt+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra={$inuxuRmsAdvId}&nwa={$inuxuPhAdvId}&nta=3&ncm={$inuxuPhCampaign}&p=v1.2&ch=chx&tm='+dt+'&rf='+_eu(d.referrer)+'&hr='+_eu(location.href)+'" width="0" height="0" style="display:none !important">');</script>
// BF_2_JS_TAG;
// 	}
    // cc,hr,rf value changed to none
	if( empty( $ret['erMsg'] ) ){
		$ret['jsCode'] = <<<BF_2_JS_TAG
<script type="text/javascript">
var d=document,_eu=function(a){return encodeURIComponent(a)},dt=(new Date()).getTime();d.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=none&u=hard-coded-uid-v1.2-'+dt+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra={$inuxuRmsAdvId}&nwa={$inuxuPhAdvId}&nta=3&ncm={$inuxuPhCampaign}&p=v1.2&ch=chx&tm='+dt+'&rf=none&hr=none" width="0" height="0" style="display:none !important">');</script>
BF_2_JS_TAG;
	}

	return $ret;
}
/**
 * [BF1_2_getPixelTag Return Outbrain pixel as javascript tag to log Backfill Campaign or Error message as array('erMsg'=>val, 'jsCode'=>val)
 * @param string $placementKey     Inpage Placement key
 * @param string $placement_id     Adtech placement id
 * @param string $rms_placement_id [description]
 * @param string $backfillKeyword  Optional,
 *
 * @return  array('erMsg'=>val, 'jsCode'=>val)
 */
function BF1_2_getOutbrainPixelTag( $placementKey , $placement_id , $rms_placement_id , $backfillKeyword='outbrain_backfill'){
	$placementKey = trim( $placementKey );
	$placement_id = trim( $placement_id );
	$rms_placement_id = trim( $rms_placement_id );
	$backfillKeyword= trim( $backfillKeyword);

	$ret['erMsg']="";
	$ret['jsCode']="";
	if( empty( $placementKey ) ){ $ret['erMsg']="Invalid placementKey"; }
	#if( empty( $placement_id ) ){ $ret['erMsg']="Invalid placement_id"; }
	if( empty( $rms_placement_id ) ){ $ret['erMsg']="Invalid rms_placement_id"; }
	if( empty( $backfillKeyword ) ){ $backfillKeyword="google_backfill"; }

    $outbrainRmsAdvId='3251770199100000';
    $outbrainPhAdvId='113';
    $outbrainPhCampaign='164';
    // nta=3 is Next adv type: Always PH (3 )
// 	if( empty( $ret['erMsg'] ) ){
// 		$ret['jsCode'] = <<<BF_2_JS_TAG
// <script type="text/javascript">
// var d=document,_eu=function(a){return encodeURIComponent(a)},dt=(new Date()).getTime();d.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=in&u=hard-coded-uid-v1.2-'+dt+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra={$inuxuRmsAdvId}&nwa={$inuxuPhAdvId}&nta=3&ncm={$inuxuPhCampaign}&p=v1.2&ch=chx&tm='+dt+'&rf='+_eu(d.referrer)+'&hr='+_eu(location.href)+'" width="0" height="0" style="display:none !important">');</script>
// BF_2_JS_TAG;
// 	}
    // cc,hr,rf value changed to none
	if( empty( $ret['erMsg'] ) ){
		$ret['jsCode'] = <<<BF_2_JS_TAG
<script type="text/javascript">
var d=document,_eu=function(a){return encodeURIComponent(a)},dt=(new Date()).getTime();d.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=none&u=hard-coded-uid-v1.2-'+dt+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra={$outbrainRmsAdvId}&nwa={$outbrainPhAdvId}&nta=3&ncm={$outbrainPhCampaign}&p=v1.2&ch=chx&tm='+dt+'&rf=none&hr=none" width="0" height="0" style="display:none !important">');</script>
BF_2_JS_TAG;
	}

	return $ret;
}

/**
 * [BF1_2_getPixelTag Return UCFunnel pixel as javascript tag to log Backfill Campaign or Error message as array('erMsg'=>val, 'jsCode'=>val)
 * @param string $placementKey     Inpage Placement key
 * @param string $placement_id     Adtech placement id
 * @param string $rms_placement_id [description]
 * @param string $backfillKeyword  Optional,
 *
 * @return  array('erMsg'=>val, 'jsCode'=>val)
 */
function BF1_2_getUCFunnelPixelTag( $placementKey , $placement_id , $rms_placement_id , $backfillKeyword='ucfunnel_backfill'){
	$placementKey = trim( $placementKey );
	$placement_id = trim( $placement_id );
	$rms_placement_id = trim( $rms_placement_id );
	$backfillKeyword= trim( $backfillKeyword);

	$ret['erMsg']="";
	$ret['jsCode']="";
	if( empty( $placementKey ) ){ $ret['erMsg']="Invalid placementKey"; }
	#if( empty( $placement_id ) ){ $ret['erMsg']="Invalid placement_id"; }
	if( empty( $rms_placement_id ) ){ $ret['erMsg']="Invalid rms_placement_id"; }
	if( empty( $backfillKeyword ) ){ $backfillKeyword="google_backfill"; }

    $outbrainRmsAdvId='3252969955000000';
    $outbrainPhAdvId='114';
    $outbrainPhCampaign='165';
    // nta=3 is Next adv type: Always PH (3 )

    // cc,hr,rf value changed to none
	if( empty( $ret['erMsg'] ) ){
		$ret['jsCode'] = <<<BF_2_JS_TAG
<script type="text/javascript">
var d=document,_eu=function(a){return encodeURIComponent(a)},dt=(new Date()).getTime();d.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=none&u=hard-coded-uid-v1.2-'+dt+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra={$outbrainRmsAdvId}&nwa={$outbrainPhAdvId}&nta=3&ncm={$outbrainPhCampaign}&p=v1.2&ch=chx&tm='+dt+'&rf=none&hr=none" width="0" height="0" style="display:none !important">');</script>
BF_2_JS_TAG;
	}

	return $ret;
}
/**
 * [BF1_2_getPixelTag Return Collectcent pixel as javascript tag to log Backfill Campaign or Error message as array('erMsg'=>val, 'jsCode'=>val)
 * @param string $placementKey     Inpage Placement key
 * @param string $placement_id     Adtech placement id
 * @param string $rms_placement_id [description]
 * @param string $backfillKeyword  Optional,
 *
 * @return  array('erMsg'=>val, 'jsCode'=>val)
 */
function BF1_2_getCollectcentPixelTag( $placementKey , $placement_id , $rms_placement_id , $backfillKeyword='collectcent_backfill'){
	$placementKey = trim( $placementKey );
	$placement_id = trim( $placement_id );
	$rms_placement_id = trim( $rms_placement_id );
	$backfillKeyword= trim( $backfillKeyword);

	$ret['erMsg']="";
	$ret['jsCode']="";
	if( empty( $placementKey ) ){ $ret['erMsg']="Invalid placementKey"; }
	#if( empty( $placement_id ) ){ $ret['erMsg']="Invalid placement_id"; }
	if( empty( $rms_placement_id ) ){ $ret['erMsg']="Invalid rms_placement_id"; }
	if( empty( $backfillKeyword ) ){ $backfillKeyword="google_backfill"; }

    $outbrainRmsAdvId='3254093827100000';
    $outbrainPhAdvId='115';
    $outbrainPhCampaign='166';
    // nta=3 is Next adv type: Always PH (3 )
    // cc,hr,rf value changed to none
	if( empty( $ret['erMsg'] ) ){
		$ret['jsCode'] = <<<BF_2_JS_TAG
<script type="text/javascript">
var d=document,_eu=function(a){return encodeURIComponent(a)},dt=(new Date()).getTime();d.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=none&u=hard-coded-uid-v1.2-'+dt+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra={$outbrainRmsAdvId}&nwa={$outbrainPhAdvId}&nta=3&ncm={$outbrainPhCampaign}&p=v1.2&ch=chx&tm='+dt+'&rf=none&hr=none" width="0" height="0" style="display:none !important">');</script>
BF_2_JS_TAG;
	}

	return $ret;
}

/**
 * [BF1_2_getPixelTag Return getGoogleL2 pixel as javascript tag to log Backfill Campaign or Error message as array('erMsg'=>val, 'jsCode'=>val)
 * @param string $placementKey     Inpage Placement key
 * @param string $placement_id     Adtech placement id
 * @param string $rms_placement_id [description]
 * @param string $backfillKeyword  Optional,
 *
 * @return  array('erMsg'=>val, 'jsCode'=>val)
 */
function BF1_2_getGoogleL2PixelTag( $placementKey , $placement_id , $rms_placement_id , $backfillKeyword='googlel2_backfill'){
	$placementKey = trim( $placementKey );
	$placement_id = trim( $placement_id );
	$rms_placement_id = trim( $rms_placement_id );
	$backfillKeyword= trim( $backfillKeyword);

	$ret['erMsg']="";
	$ret['jsCode']="";
	if( empty( $placementKey ) ){ $ret['erMsg']="Invalid placementKey"; }
	#if( empty( $placement_id ) ){ $ret['erMsg']="Invalid placement_id"; }
	if( empty( $rms_placement_id ) ){ $ret['erMsg']="Invalid rms_placement_id"; }
	if( empty( $backfillKeyword ) ){ $backfillKeyword="google_backfill"; }

    $RmsAdvId='43100000';
    $PhAdvId='31';
    $PhCampaign='150';
    // nta=3 is Next adv type: Always PH (3 )
    // cc,hr,rf value changed to none
	if( empty( $ret['erMsg'] ) ){
		$ret['jsCode'] = <<<BF_2_JS_TAG
<script type="text/javascript">
var d=document,_eu=function(a){return encodeURIComponent(a)},dt=(new Date()).getTime();d.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=none&u=hard-coded-uid-v1.2-'+dt+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra={$RmsAdvId}&nwa={$PhAdvId}&nta=3&ncm={$PhCampaign}&p=v1.2&ch=chx&tm='+dt+'&rf=none&hr=none" width="0" height="0" style="display:none !important">');</script>
BF_2_JS_TAG;
	}

	
	return $ret;
}
// To get placement details of infooter
function BF12_getInFooterPlDetails ($prodID, $plKey) {
	require_once('../../includes/config/config.inc.php');
	require_once('../../includes/libs/MysqliDatabase.class.php');

    $db = MysqliDatabase::getInstance(constant('DB_CON_STRING_IP'));

	// $sql = "CALL sp_ph_select_pubkey_adtecurl_site_from_placement_key_v22('$placementKey')";
	// $sql = "CALL sp_ph_select_pubkey_adtecurl_site_from_placement_key_bf1_2_v1('$placementKey')";
	$sql = "call sp_ph_select_adunit_placement_productwise($prodID, '{$plKey}');";

	$row = $db->multi_query($sql, /*$isSingleResultSet*/false, __FUNCTION__);

	#echo '<pre>'; var_dump( $row ); die();
    if( !empty($row) && !empty($row[0]) && !empty($row[0][0]) ){
		$ret=array();
		$row = $row[0][0];
		$ret['placement_id'] = $row['ad_unit_id']; // Adtech Placement Id
		$ret['rms_placement_id'] = $row['rms_placement_id'];
		$ret['rms_placement_name'] = $row['rms_placement_name'];
		$ret['size_id'] = "";
		$ret['original_backfill_code'] = "";
		// $ret['original_backfill_code'] = trim($row['original_backfill_code']);
		return $ret;
    }

    return 0;
}

/**
 * [BF1_2_getAllPixelTag Return All pixel as javascript tag to log Backfill Campaign or Error message as array('erMsg'=>val, 'jsCode'=>val)
 * @param string $placementKey     Inpage Placement key
 * @param string $placement_id     Adtech placement id
 * @param string $rms_placement_id [description],
 *
 * @return  array('erMsg'=>val, 'jsCode'=>val)
 */

 function BF1_2_getAllPixelTag($placementKey , $placement_id , $rms_placement_id)
 {
	$pixelArr = array('outInuxu'=>'outInuxu','outOutbrain'=>'outOutbrain','outUCFunnel'=>'outUCFunnel','outCollectCent'=>'outCollectCent','outGoogleL2'=>'outGoogleL2');
	$placementKey = trim( $placementKey );
	$placement_id = trim( $placement_id );
	$rms_placement_id = trim( $rms_placement_id );
	$backfillKeyword = "";
	$ret['erMsg']="";
	if( empty( $placementKey ) ){ $ret['erMsg']="Invalid placementKey"; }
	#if( empty( $placement_id ) ){ $ret['erMsg']="Invalid placement_id"; }
	if( empty( $rms_placement_id ) ){ $ret['erMsg']="Invalid rms_placement_id"; }
	if( empty( $backfillKeyword ) ){ $backfillKeyword="google_backfill"; }
	
		foreach($pixelArr as $pk => $pv)
		{	
			$ret[$pk] = BF1_2_getPixelId($pv);

			if(empty($ret['msg']))
			{

$ret[$pk]['jsCode'] = <<<BF_2_JS_TAG
<script type="text/javascript">
var d=document,_eu=function(a){return encodeURIComponent(a)},dt=(new Date()).getTime();d.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=none&u=hard-coded-uid-v1.2-'+dt+'&s=1&b={$ret[$pk]['backfillKeyword']}&rq=2&bl={$ret[$pk]['backfillKeyword']}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra={$ret[$pk]['advId']}&nwa={$ret[$pk]['PhAdvId']}&nta=3&ncm={$ret[$pk]['PhCampaign']}&p=v1.2&ch=chx&tm='+dt+'&rf=none&hr=none" width="0" height="0" style="display:none !important">');</script>
BF_2_JS_TAG;
			}
			
		}
		return $ret;

 }
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
/**
 * [BF1_2_getPixelId Return All pixel ids array consisting of advertising Id
 * @param string $pixelType        Type of Pixel
 */


function BF1_2_getPixelId($pixelType)
{
	$data = array();
	if($pixelType == 'outInuxu')
	{
		$data['keyName'] = 'Inuxu';
		$data['advId'] = '189542200000';
		$data['PhAdvId'] = '104';
		$data['PhCampaign'] = '156';
		$data['backfillKeyword'] = 'inuxu_backfill';
	}
	if($pixelType == 'outOutbrain')
	{
		$data['keyName'] = 'Outbrain';
		$data['advId'] = '3251770199100000';
		$data['PhAdvId'] = '113';
		$data['PhCampaign'] = '164';
		$data['backfillKeyword'] = 'outbrain_backfill';
	}
	if($pixelType == 'outUCFunnel')
	{
		$data['keyName'] = 'UCFunnel';
		$data['advId'] = '3252969955000000';
		$data['PhAdvId'] = '114';
		$data['PhCampaign'] = '165';
		$data['backfillKeyword'] = 'ucfunnel_backfill';
	}
	if($pixelType == 'outCollectCent')
	{
		$data['keyName'] = 'CollectCent';
		$data['advId'] = '3254093827100000';
		$data['PhAdvId'] = '115';
		$data['PhCampaign'] = '166';
		$data['backfillKeyword'] = 'collectcent_backfill';
	}
	if($pixelType == 'outGoogleL2')
	{
		$data['keyName'] = 'GoogleL2';
		$data['advId'] = '43100000';
		$data['PhAdvId'] = '31';
		$data['PhCampaign'] = '150';
		$data['backfillKeyword'] = 'googlel2_backfill';
	}
	return $data;
} 


//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
/**
 * [BF1_2_getHTMLPage Generate HTML page with BF1.2 pixel + Pub-Backfill-js registered in In-Page ari
 * @param string $placementKey     Inpage Placement key
 * @param int $withoutPreview      0=> wrap code in text area with display name, 1=> return only bakcfill html code
 */


function BF1_2_getHTMLPage( $placementKey , $backfillKeyword='google_backfill', $withoutPreview=0, $productID ){

	if ($productID == 4) {
		$row = BF12_getInpageData_rmsAri( $placementKey);
	} else if ($productID == 3) {
		$row = BF12_getInFooterPlDetails($productID, $placementKey);
	} else {
		echo "Invalid Product";
		//die();
	}

	$original_backfill_code = "<!-- Pub-backfill not found -->";
	$rms_placement_name='';

	$outInuxu=array('jsCode'=>'');
	
	if( empty($row) ){
		$out['erMsg']="Fail to fetch details from database for '{$placementKey}'";
		$out['jsCode']="";
		$pixelData = BF1_2_getAllPixelTag($placementKey , $placement_id , $rms_placement_id);
		
	}else{
		$rms_placement_name = $row['rms_placement_name'];
		$original_backfill_code = trim($row['original_backfill_code']);

		$out = BF1_2_getPixelTag( $placementKey , $row['placement_id'] , $row['rms_placement_id'] , $backfillKeyword);
		$pixelData = BF1_2_getAllPixelTag($placementKey , $placement_id , $rms_placement_id);
       /*  $outInuxu = BF1_2_getInuxuPixelTag( $placementKey , $row['placement_id'] , $row['rms_placement_id'] );
        $outOutbrain = BF1_2_getOutbrainPixelTag( $placementKey , $row['placement_id'] , $row['rms_placement_id'] );
        $outUCFunnel = BF1_2_getUCFunnelPixelTag( $placementKey , $row['placement_id'] , $row['rms_placement_id'] );
        $outCollectCent = BF1_2_getCollectcentPixelTag( $placementKey , $row['placement_id'] , $row['rms_placement_id'] );
        $outGoogleL2 = BF1_2_getGoogleL2PixelTag( $placementKey , $row['placement_id'] , $row['rms_placement_id'] ); */
    }


	if( !empty($out['erMsg']) ){
		$ret = "<span style='color:red'>{$out['erMsg']}</span>";
		return array('html'=>$ret, 'data'=>$row);
	}else{

		$wrapeInHtmlTag = 0;//(false !== strpos($backfillKeyword, 'google') );

	 	$jsCode = "
<!-- Start Of BF1.2 Pixel -->
{$out['jsCode']}
<!-- End Of BF1.2 Pixel -->

<!-- Start Of Pub-backfill -->
{$original_backfill_code}
<!-- End Of Pub-backfill --> ";

		$ret = "";
		if( empty( $withoutPreview ) ){
			$textAreaLines = count( explode( "\n", $jsCode )  ) + 4 ;
			$ret ="
			<br><br>Backfill V1.2 Pixel Script for <b>$rms_placement_name - {$placementKey}</b><br>
			<a href='?pid={$placementKey}&backfillKeyword={$backfillKeyword}&withoutPreview=1'>Run Bellow HTML</a><br>
			<textarea cols='120' rows='{$textAreaLines}' readonly style='padding:10px;' onclick='this.setSelectionRange(0, this.value.length)'>";
			
		}else{
			$wrapeInHtmlTag=1;
		}

		if( $wrapeInHtmlTag ){
			$ret .="<html><body style=\"border:0;padding:0;margin:0\">\n";
		}

		$ret .=$jsCode;

		if( $wrapeInHtmlTag ){
			$ret .="\n\n</body></html>\n";
		}

		if( empty( $withoutPreview ) ){
			$ret .="</textarea>";
		}

		if (empty( $withoutPreview )) {

		unset($pixelData['erMsg']);
		foreach($pixelData as $pk => $pv)
		{
			$tableHeading = $pv['keyName'];
			$ret.="<br><br><hr><h2>{$tableHeading} BF1.2 </h2>
			<textarea cols='120' rows='{$textAreaLines}' readonly style='padding:10px;' onclick='this.setSelectionRange(0, this.value.length)'>
			<!-- Start Of BF1.2 {$tableHeading} Pixel -->
			{$pv['jsCode']}
			<!-- End Of BF1.2 {$tableHeading} Pixel -->
					</textarea>";
		}
			
        /* $ret .="
        <br><br><hr><h2>Inuxu BF1.2 </h2>
        <textarea cols='120' rows='{$textAreaLines}' readonly style='padding:10px;' onclick='this.setSelectionRange(0, this.value.length)'>
<!-- Start Of BF1.2 Inuxu Pixel -->
{$outInuxu['jsCode']}
<!-- End Of BF1.2 Inuxu Pixel -->
        </textarea>";
        $ret .="
        <br><br><hr><h2>Outbrain BF1.2 </h2>
        <textarea cols='120' rows='{$textAreaLines}' readonly style='padding:10px;' onclick='this.setSelectionRange(0, this.value.length)'>
<!-- Start Of BF1.2 Outbrain Pixel -->
{$outOutbrain['jsCode']}
<!-- End Of BF1.2 Outbrain Pixel -->
        </textarea>";

        $ret .="
        <br><br><hr><h2>UCFunnel BF1.2 </h2>
        <textarea cols='120' rows='{$textAreaLines}' readonly style='padding:10px;' onclick='this.setSelectionRange(0, this.value.length)'>
<!-- Start Of BF1.2 UCFunnel Pixel -->
{$outUCFunnel['jsCode']}
<!-- End Of BF1.2 UCFunnel Pixel -->
        </textarea>";

        $ret .="
        <br><br><hr><h2>Collectcent BF1.2 </h2>
        <textarea cols='120' rows='{$textAreaLines}' readonly style='padding:10px;' onclick='this.setSelectionRange(0, this.value.length)'>
<!-- Start Of BF1.2 Collectcent Pixel -->
{$outCollectCent['jsCode']}
<!-- End Of BF1.2 Collectcent Pixel -->
        </textarea>";
	
        
        $ret .="
        <br><br><hr><h2>GoogleL2 BF1.2 </h2>
        <textarea cols='120' rows='{$textAreaLines}' readonly style='padding:10px;' onclick='this.setSelectionRange(0, this.value.length)'>
<!-- Start Of BF1.2 GoogleL2 Pixel -->
{$outGoogleL2['jsCode']}
<!-- End Of BF1.2 GoogleL2 Pixel -->
        </textarea>"; */
		}

		return array('html'=>$ret, 'data'=>$row);

	}
}
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
function BF1_2_getBackfillKeywordAsOption( $backfillKeyword ){
	$arrBackfillKeywords = array("google100",
"google2_backfill",
"google_backfill",
"googleus2_backfill",
"googleus_backfill",
"acsencion_backfill",
"adcom_backfill",
"adjuggler_backfill",
"affinity_internal_backfill",
"altitude_backfill",
"appnexus_backfill",
"batanga_backfill",
"burst_backfill",
"casale_backfill",
"contextweb_backfill",
"cox_backfill",
"cpxfloor_backfill",
"criteo_backfill",
"dfp_backfill",
"improved_backfill",
"inm_backfill_killswitch",
"komliadmax_backfill",
"komli_retarget",
"lijit_backfill",
"max_backfill",
"mf_backfill_killswitch",
"openx_backfill",
"pubmatic_backfill",
"radiumone_backfill",
"rubicon_backfill",
"sonobi_backfill",
"technorati_backfill",
"tlvmedia_backfill",
"valueclick_backfill",
"outbrain_backfill"
);

	$arrOption=array();
	foreach( $arrBackfillKeywords as $xKeyword ){
		$selected = ($backfillKeyword == $xKeyword ) ? ' selected="selected" ' : '';
		$arrOption[] = "<option value=\"{$xKeyword}\" {$selected} >{$xKeyword}</option>";
	}

	return implode( "\n", $arrOption );
}
//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

error_reporting(E_ALL); ini_set('display_errors','On');

$placementKey = empty($_GET['pid']) ? "" : trim( $_GET['pid'] );
$productID = empty($_GET['product']) ? "" : trim( $_GET['product'] );
$backfillKeyword = empty($_GET['backfillKeyword']) ? "google_backfill" : trim( $_GET['backfillKeyword'] );
$withoutPreview = empty($_GET['withoutPreview']) ? "" : trim( $_GET['withoutPreview'] );
$proOptStr = $productID == "3" 
							? "<option value=4>In-Page</option><option value=3 selected>In-Footer</option>"
							: "<option value=4 selected>In-Page</option><option value=3>In-Footer</option>";


if( $withoutPreview ){
	$data=BF1_2_getHTMLPage( $placementKey , $backfillKeyword, $withoutPreview=1, $productID);
	echo $data['html'];
	exit(0);
}

echo "<html><head><title>BF1.2 Tag</title></head><body>

<h1>Generating Backfill V1.2 Page HTML code with Pixel and Pub-backfill tag </h1>

<form>
<label for='elBackfillKeyword'>Backfill Keyword</label>
<select name='backfillKeyword' id='elBackfillKeyword'>". BF1_2_getBackfillKeywordAsOption( $backfillKeyword )."</select>
<label for='product'>Product</label>
<select name='product' id='product'>". $proOptStr ."</select>
Placement Key / Ad Unit Id <input name='pid' type='text' value='{$placementKey}' /> &nbsp;&nbsp;&nbsp; <input type='submit'></form>

<!--  RMS and In-Page link to navigat to current pid -->
<a href='https://rms.ph.ari.hwpub.com/rms/product-mapping.php?placement_id={$placementKey}' target='_blank'>RMS > Product Mapping of {$placementKey}</a>&nbsp;&nbsp;&nbsp;
<a href='https://inpage.ari.hwpub.com/placement-mapping.php?search_text={$placementKey}&search_type=placement_key' target='_blank'>In-Page > Placement Mapping of {$placementKey}</a><br>";


$data=BF1_2_getHTMLPage( $placementKey , $backfillKeyword, $withoutPreview=0, $productID );
echo $data['html'];

$adSizes = array (
'1' => '468x60',
'154' => '160x600',
'168' => '120x600',
'170' => '300x250',
'225' => '728x90',
'529' => '300x600',
'165' => '250x250',
'1103' => '300x251',
'1104' => '300x252',
'3058' => '728x96',
'4037' => '728x100',
'711' => '300x50',
'3055' => '320x50',
'6317' => '728x91',
'6318' => '728x92',
'2759' => '160x601',
'2758' => '160x602',
'6321' => '120x601',
'6322' => '120x602',
'6323' => '468x61',
'6324' => '468x62',
'171' => '336x280',
'2473' => '970x90',
'2466' => '970x250',
'457' => '300x100',
);

list($width, $height) = explode( "x", $adSizes[$data['data']['size_id'] ] );


echo "<br><iframe src='/backfill_generator/backfill_gen_helper_v1.php?product={$productID}pid={$placementKey}&backfillKeyword={$backfillKeyword}&withoutPreview=1'
width='{$width}' height='{$height}' frameborder='0' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' topmargin='0' leftmargin='0' allowtransparency='true'></iframe>";

echo '</body></html>';

?>
<!-- <script type="text/javascript">
var d=document,_eu=function(a){return encodeURIComponent(a)},dt=(new Date()).getTime();d.write('<img src="http://lg.ph.affinity.com/a?v=v1.2&pid={$placementKey}&rmp={$rms_placement_id}&app=&adp={$placementKey}&cc=in&u=hard-coded-uid-v1.2-'+dt+'&s=1&b={$backfillKeyword}&rq=2&bl={$backfillKeyword}&bi=1&i=1&ra=1&wa=1&ta=1&cm=1&prq=1&ni=1&nra={$inuxuRmsAdvId}&nwa={$inuxuPhAdvId}&nta=3&ncm={$inuxuPhCampaign}&p=v1.2&ch=chx&tm='+dt+'&rf='+_eu(d.referrer)+'&hr='+_eu(location.href)+'" width="0" height="0" style="display:none !important">');</script> -->
